/**
 * Created by Administrator on 14-3-20.
 */
define(['angular', 'config'], function (angular, config) {
    /*-----------------------------------------
     * angulajs锚点处理
     ------------------------------------------*/
    angular.module('lemon.service.AnchorScroll', [])
        .factory('anchorScroll', function () {
            function toView(element, top, height) {
                var winHeight = $(window).height();

                element = $(element);
                height = height > 0 ? height : winHeight / 10;
                $('html, body').animate({
                    scrollTop: top ? (element.offset().top - height) : (element.offset().top + element.outerHeight() + height - winHeight)
                }, {
                    duration: 200,
                    easing: 'linear',
                    complete: function () {
                        if (!inView(element)) {
                            element[0].scrollIntoView( !! top);
                        }
                    }
                });
            }

            function inView(element) {
                element = $(element);

                var win = $(window),
                    winHeight = win.height(),
                    eleTop = element.offset().top,
                    eleHeight = element.outerHeight(),
                    viewTop = win.scrollTop(),
                    viewBottom = viewTop + winHeight;

                function isInView(middle) {
                    return middle > viewTop && middle < viewBottom;
                }

                if (isInView(eleTop + (eleHeight > winHeight ? winHeight : eleHeight) / 2)) {
                    return true;
                } else if (eleHeight > winHeight) {
                    return isInView(eleTop + eleHeight - winHeight / 2);
                } else {
                    return false;
                }
            }

            return {
                toView: toView,
                inView: inView
            };
        });
});